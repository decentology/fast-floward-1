# æé€ŸFlowå­¦ä¹ ä¹‹æ—…(Fast Floward) | ç¬¬ 1 å‘¨ | ç¬¬ 2 å¤©

æ¬¢è¿å›æ¥ï¼æˆ‘å¸Œæœ›ç¬¬ä¸€å¤©çš„å­¦ä¹ å……æ»¡ä¹è¶£ã€‚ä»Šå¤©æˆ‘ä»¬å°†äº†è§£å¦ä¸€ä¸ª Flow å¼€å‘è€…å·¥å…·â€”â€”**ä»£ç æ¼”ç»ƒåœº(Playground)**ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ç¼–å†™æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª *æ™ºèƒ½åˆçº¦*ï¼Œå¹¶ä½¿ç”¨ *äº¤æ˜“* å’Œ *è„šæœ¬* ä¸ä¹‹äº¤äº’ã€‚åº”è¯¥å¾ˆåˆºæ¿€ï¼ä½†é¦–å…ˆï¼Œè®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹æˆ‘ä»¬åœ¨ç¬¬ä¸€å¤©å­¦åˆ°çš„ä¸œè¥¿ã€‚

# ç¬¬ 1 å¤©çš„å­¦ä¹ å›é¡¾

- Flow æ˜¯ä¸€ä¸ªå¾ˆé…·çš„åŒºå—é“¾ã€‚
- Cadence æ˜¯ç”¨äºåœ¨ Flow ä¸Šç¼–å†™ DApp çš„ç¼–ç¨‹è¯­è¨€ã€‚
- æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `flow cadence` ä½œä¸º REPL shellï¼Œæˆ–è€… ä½¿ç”¨ `flow cadence file.cdc` æ¥æ‰§è¡Œè„šæœ¬ã€‚
- Cadence æ˜¯ä¸¥æ ¼ç±»å‹åŒ–çš„ï¼Œæˆ‘ä»¬æ¢ç´¢äº†ä»¥ä¸‹å†…ç½®ç±»å‹ã€‚
  - `Int`
  - `Fix64`
  - `Address`
  - `String`
  - `Array`
  - `Dictionary`
- Cadence å¯é€‰é¡¹ ï¼ˆoptionalsï¼‰, æ¯”å¦‚ `let optional: String?`, å½“å€¼å¯ä»¥æ˜¯ `nil` æ—¶ä½¿ç”¨ã€‚
- Cadence å‡½æ•°æ˜¯å¸¦æœ‰å‘½åæ ‡ç­¾çš„å€¼ç±»å‹ã€‚
- Cadence æœ‰ä¸¤ç§å¤åˆç±»å‹:
  - ç»“æ„ `struct`: å€¼ç±»å‹ï¼ˆå¯å¤åˆ¶çš„ï¼‰,
  - èµ„æº `resource`: çº¿æ€§ç±»å‹ï¼ˆå¯ç§»åŠ¨çš„ï¼Œåªèƒ½å­˜åœ¨ä¸€æ¬¡ï¼‰ã€‚
- Cadence çš„èµ„æºç±»å‹`resource` ä½¿ç”¨`<-` è¡¨ç¤ºç§»åŠ¨ï¼Œç‰¹æ®Šå…³é”®å­—`create` å’Œ`destroy`ï¼Œä»¥åŠ`@` è¡¨ç¤ºèµ„æºç±»å‹ï¼Œä¾‹å¦‚`let canvas: @Canvas`ã€‚

# è§†é¢‘

- [ç¬¬ 2 å¤© â€“ å›é¡¾ã€Flow Playgroundã€æ™ºèƒ½åˆçº¦ã€äº¤æ˜“ã€è„šæœ¬ + ä½œä¸šä»»åŠ¡](https://youtu.be/4wpoqDKzw8Y)

# ä½œä¸šç­”ç–‘æ—¶é—´

- [ä½œä¸šä»»åŠ¡çš„å®ç°å’Œä¸€èˆ¬æ€§é—®ç­”](https://www.youtube.com/watch?v=DwLdLnx8jKE)

# ä»£ç æ¼”ç»ƒåœº(Playground)

æˆ‘ä»¬ä½¿ç”¨ `flow cadence` æ‰§è¡Œäº†ç¬¬ä¸€è¡Œ Cadence ä»£ç ã€‚è¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…¥é—¨æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªç¼–ç¨‹è¯­è¨€è§£é‡Šå™¨ã€‚ç„¶è€Œï¼Œå»ä¸­å¿ƒåŒ–åº”ç”¨ç¨‹åºä¸ä»…ä»…æ˜¯è§£é‡Šæ‰§è¡Œä»£ç ï¼Œå®ƒä»¬è¿˜éœ€è¦ä¸åŒºå—é“¾çš„å…¨å±€çŠ¶æ€äº¤äº’ã€‚

Flow ä¸ºæˆ‘ä»¬æä¾›äº†è®¸å¤šå…¥é—¨é€‰é¡¹ã€‚

- ä¸€ä¸ªå…¬å…±æµ‹è¯•ç½‘
- ä¸€ä¸ªç‹¬ç«‹çš„æœ¬åœ° Flow æ¨¡æ‹Ÿå™¨
- ä»£ç æ¼”ç»ƒåœº(Playground)

ä»Šå¤©ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ **Playground**ï¼Œä½†æˆ‘ä»¬å°†åœ¨æœ¬å‘¨æ™šäº›æ—¶å€™å°è¯•å¦å¤–ä¸¤ä¸ªè§£å†³æ–¹æ¡ˆã€‚

## ç¯å¢ƒ

å¯åŠ¨æµè§ˆå™¨å¹¶æ‰“å¼€ [play.onflow.org][1] ä»¥å¯åŠ¨ ä»£ç æ¼”ç»ƒåœº(Playground)ã€‚

![ä»£ç æ¼”ç»ƒåœºæˆªå›¾](images/playground.jpg)

ä»£ç æ¼”ç»ƒåœº(Playground) ç•Œé¢æœ‰5ä¸ªå…³é”®éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬æ¥é€ä¸€çœ‹çœ‹æ¯ä¸€ä¸ªã€‚

## Cadence ç¼–è¾‘å™¨

è¿™æ˜¯æ‚¨å­˜å‚¨ Cadence ä»£ç çš„åœ°æ–¹ã€‚ç”±äº Playground æ¨¡æ‹Ÿäº† Flow åŒºå—é“¾ï¼Œå› æ­¤ Playground æœ‰ä¸€äº› Cadence REPL shell ä¸­ä¸å­˜åœ¨çš„ç‰¹æ®Šé™åˆ¶ã€‚

- æ‚¨åªèƒ½åœ¨ **åˆçº¦** ç¼–è¾‘å™¨ä¸­å®šä¹‰ `contract`ã€`struct` å’Œ `resource` ç±»å‹ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»å·¦ä¾§çª—æ ¼ä¸­é€‰æ‹©ä»»ä½• **account** æ¥æ‰“å¼€è¯¥ç¼–è¾‘å™¨ã€‚
- åŒæ ·çš„é™åˆ¶é€‚ç”¨äº Cadence `äº‹ä»¶ event`ç±»å‹ã€‚

å‡†å¤‡å¥½éƒ¨ç½²åˆçº¦åï¼Œç‚¹å‡»ç»¿è‰²çš„ **Deploy** æŒ‰é’®ã€‚é‡æ–°ç‚¹å‡»è¯¥æŒ‰é’®ä¼šå†ä¸€æ¬¡éƒ¨ç½²åˆçº¦ã€‚

Flow Playground å…è®¸æ‚¨æ›´æ–°ç°æœ‰åˆçº¦ï¼Œä½†æ˜¯ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œæœ‰æ—¶æ›´æ–°å¯èƒ½ä¼šå¤±è´¥ï¼Œå¦‚æœæ‚¨é‡åˆ°ä¸åº”è¯¥å‡ºç°çš„é—®é¢˜ï¼Œè¯·å°è¯•æ‰“å¼€ä¸€ä¸ªæ–°çš„ Playground å¹¶åœ¨é‚£é‡Œéƒ¨ç½²æ‚¨çš„åˆçº¦ã€‚

![Cadence ç¼–è¾‘å™¨](images/editor.jpg)

## è´¦å·

åœ¨ Flow ä¸­ï¼Œä¸€åˆ‡éƒ½ä¸å¸æˆ·ä¸€èµ·å­˜å‚¨ï¼ŒåŒ…æ‹¬æ™ºèƒ½åˆçº¦ã€‚å› æ­¤ï¼Œæ— è®ºåšä»€ä¹ˆï¼Œæ‚¨éƒ½éœ€è¦è®¿é—®ä¸€ä¸ªæˆ–å¤šä¸ªå¸æˆ·ï¼Œå¹¸å¥½ Flow Playground ä¸ºæˆ‘ä»¬æä¾›äº† 5 ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„å¸æˆ·ã€‚è¿™å°†ä¸ºæˆ‘ä»¬æå¤§çš„èŠ‚çœäº†æ—¶é—´ã€‚

Playground çš„ä¸€ä¸ªé™åˆ¶æ˜¯æ¯ä¸ªè´¦æˆ·åªèƒ½éƒ¨ç½²ä¸€ä¸ªåˆçº¦ã€‚

![è´¦æˆ·](images/accounts.jpg)


## äº¤æ˜“

è¿™æ˜¯æ‚¨å®šä¹‰ Flow äº¤æ˜“çš„åœ°æ–¹ã€‚äº¤æ˜“é€šå¸¸ç”¨äºæ”¹å˜åŒºå—é“¾çš„çŠ¶æ€ï¼Œå› æ­¤éœ€è¦ç”±æ¶‰åŠçš„æ¯ä¸€ä¸ªå‚ä¸æ–¹ç­¾åã€‚ä¸å…¶ä»–åŒºå—é“¾ä¸€æ ·ï¼ŒFlow äº¤æ˜“å¿…é¡»ä½¿ç”¨ç§é’¥è¿›è¡ŒåŠ å¯†ç­¾åï¼Œä»¥å¯¹äº¤æ˜“æ•°æ®è¿›è¡Œç¼–ç ã€‚å€¼å¾—åº†å¹¸çš„æ˜¯ï¼ŒPlayground å¯¹æ­¤è¿›è¡Œäº†æŠ½è±¡ï¼Œç­¾ç½²äº¤æ˜“åªéœ€ä¸€é”®å³å¯å®Œæˆã€‚

![äº¤æ˜“](images/transactions.jpg)


## è„šæœ¬

**è„šæœ¬** é¢æ¿æ˜¯æ‚¨å®šä¹‰ Flow è„šæœ¬çš„åœ°æ–¹ï¼Œè¿™äº›è„šæœ¬æ˜¯ä¸éœ€è¦ä»»ä½•åŒºå—é“¾æ”¹å˜çŠ¶æ€çš„åªè¯»ç¨‹åºã€‚å› æ­¤ï¼Œä¸äº¤æ˜“ä¸åŒï¼ˆå³ä½¿ Playground æ²¡æœ‰ä»»ä½•è´¹ç”¨ï¼‰ï¼Œå®ƒä»¬ä¸ä¼šäº§ç”Ÿ gas è´¹ç”¨ï¼Œå¹¶ä¸”å®ƒä»¬ä¸éœ€è¦ä»»ä½•å¸æˆ·çš„ç­¾åæˆæƒã€‚

![è„šæœ¬](å›¾ç‰‡/è„šæœ¬.jpg)

## æ—¥å¿—å’Œå­˜å‚¨

Cadence ä¸ºå¼€å‘äººå‘˜æä¾›äº†éå¸¸æ–¹ä¾¿çš„æ—¥å¿—åŠŸèƒ½ - `log()`ã€‚æ‚¨å¯ä»¥è®°å½•å˜é‡ï¼ŒæŸ¥çœ‹ç¨‹åºæ‰§è¡Œæ—¶çŠ¶æ€å¦‚ä½•å˜åŒ–ï¼Œæˆ‘ä»¬å·²ç»é€šè¿‡ `flow cadence` ä½“éªŒåˆ°äº†è¿™ä¸€ç‚¹ã€‚ Playground æ˜¯å¦ä¸€ä¸ªè®©ä½ çœ‹åˆ°ä½ çš„ `log()` è¾“å‡ºçš„åœ°æ–¹ã€‚

ä¸€æ—¦æ‚¨å¼€å§‹ä½¿ç”¨å¸æˆ·å­˜å‚¨æ•°æ®ï¼Œæ‚¨è¿˜ä¼šåœ¨åº•éƒ¨çª—æ ¼ä¸­æ‰¾åˆ°å¸æˆ·çš„å­˜å‚¨ä¿¡æ¯ã€‚

![æ—¥å¿—å’Œå­˜å‚¨](images/logAndStorage.jpg)


# æ™ºèƒ½åˆçº¦ #1

è®©æˆ‘ä»¬åˆ›å»ºæˆ‘ä»¬çš„ç¬¬ä¸€ä¸ª Cadence æ™ºèƒ½åˆçº¦ï¼

1. ä» **è´¦å·(Accounts)** çª—æ ¼ä¸­é€‰æ‹© `0x01`ã€‚
2. è¾“å…¥ä»¥ä¸‹ä»£ç 

```cadence
pub contract Hello {
  pub fun sayHi(to name: String) {
    log("Hi, ".concat(name))
  }
}
```

3. ç‚¹å‡» **Deploy**
4. ä»æ—¥å¿—ä¸­è·å–ç¡®è®¤ä¿¡æ¯ã€‚

```
11:11:11 Deployment > [1] > Deployed Contract To: 0x01
```

æ­¤æ—¶ï¼Œæ‚¨å°†åœ¨â€œå¸æˆ·â€çª—æ ¼ä¸­çš„â€œ0x01â€å¸æˆ·ä¸‹çœ‹åˆ°æ‚¨éƒ¨ç½²çš„åˆåŒçš„åç§°ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåç§°ç›´æ¥å–è‡ªæºä»£ç ï¼Œä½†åœ¨ Playground ä¹‹å¤–ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `name: String` å’Œåˆçº¦æºä»£ç éƒ¨ç½²åˆçº¦ã€‚ å› æ­¤ï¼Œæ¯ä¸ªå¸æˆ·å¯ä»¥åœ¨ä¸åŒåç§°ä¸‹æ‹¥æœ‰åŒä¸€åˆçº¦çš„å¤šä¸ªå®ä¾‹ã€‚ å¦‚å‰æ‰€è¿°ï¼ŒPlayground å¸æˆ·æ¯ä¸ªä»…æ”¯æŒä¸€ä»½åˆçº¦ã€‚


å¥½çš„ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»éƒ¨ç½²äº†ä¸€ä¸ªåŒºå—é“¾ç¨‹åºï¼Œè®©æˆ‘ä»¬ä¸å®ƒè¿›è¡Œäº¤äº’å§ï¼ Flow æä¾›äº†ä¸¤ç§ä¸åŒçš„æ–¹æ³•æ¥åšåˆ°è¿™ä¸€ç‚¹ã€‚

- è„šæœ¬ï¼šåŒ¿åå’Œåªè¯»ã€‚
- äº¤æ˜“ï¼šç»è¿‡èº«ä»½éªŒè¯ï¼Œå¯ä»¥æ”¹å˜åŒºå—é“¾çŠ¶æ€ï¼Œå¹¶ä¸”ç»è¿‡åŠ å¯†ç­¾åã€‚

æˆ‘ä»¬å°†åˆ†åˆ«ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œæ¥åœ¨å®è·µä¸­ä½¿ç”¨è¿™ä¸¤ç§æ–¹å¼ã€‚ ç‚¹å‡»**Script**ï¼Œè®©æˆ‘ä»¬ç¼–å†™ä¸€äº›ä»£ç ã€‚


# è„šæœ¬ #1


è¿™å¯¹æ‚¨æ¥è¯´åº”è¯¥å¾ˆç†Ÿæ‚‰ã€‚ æˆ‘ä»¬åœ¨ç¬¬ 1 å¤©ä½¿ç”¨ç›¸åŒçš„å…¥å£ç‚¹ `main()` æ¥è¿è¡Œæˆ‘ä»¬çš„ Cadence ä»£ç ï¼Œä½†ç°åœ¨æˆ‘ä»¬å¯ä»¥è®¿é—®æ™ºèƒ½åˆçº¦äº†ï¼

æˆ‘ä»¬é¦–å…ˆä»æ‰˜ç®¡åˆçº¦çš„è´¦æˆ·åœ°å€â€œå¯¼å…¥â€æˆ‘ä»¬æƒ³è¦ä¸ä¹‹äº¤äº’çš„åˆçº¦ã€‚ æ‚¨å¯ä»¥å°†æ­¤æ¨¡å¼è§†ä¸ºå¾ˆåƒä»åŒ…ç®¡ç†å™¨ä¸­çš„åº“ä¸­å¯¼å…¥ç±»æ—¶çš„æƒ…å†µã€‚ è€ƒè™‘åˆ° Flow ä¸Šçš„æƒ…å†µï¼Œæ‰€æœ‰å†…å®¹éƒ½ä¸å¸æˆ·ä¸€èµ·å­˜å‚¨ï¼Œè‡ªç„¶è€Œç„¶åœ°å®ƒä»¬å­˜å‚¨æ‰€æœ‰ç°æœ‰çš„åˆçº¦ã€‚


```cadence
import Hello from 0x01

pub fun main() {
  let name = "FastFloward"
  Hello.sayHi(to: name)
}
```

å•å‡» **Execute**ï¼Œæ‚¨å°†åœ¨ **Log** çª—æ ¼ä¸­çœ‹åˆ°å¦‚ä¸‹çš„ä¸¤è¡Œã€‚

```
11:11:11 Script > [1] > "Hi, FastFloward"
11:11:11 Script > [2] Result > {"type":"Void"}
```

æ‚¨é€šå¸¸ä½¿ç”¨è„šæœ¬è·å–æœ‰å…³å…¬å…±çŠ¶æ€çš„ä¿¡æ¯ï¼Œå› æ­¤é¢„è®¡å®ƒä»¬ä¼šâ€œè¿”å›â€æŸç§å€¼ã€‚ åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼è¿”å›ä»»ä½•ä¸œè¥¿ï¼Œç±»ä¼¼äº JavaScriptä¸­ï¼Œå½“å‡½æ•°è¿”å› undefined æ—¶ï¼Œåœ¨æ²¡æœ‰æ˜¾å¼ return è¯­å¥çš„ Cadence å‡½æ•°ä¸­è¿”å› Void ç±»å‹ã€‚

ç°åœ¨ï¼Œç»§ç»­çœ‹çœ‹äº¤æ˜“çš„ä¾‹å­éƒ¨åˆ†......

# äº¤æ˜“ #1


ä½œä¸ºå‚è€ƒï¼Œè¯·ä½¿ç”¨[æ–‡æ¡£][2]ã€‚ æˆ‘ä»¬çš„è„šæœ¬èƒ½å¤Ÿä¸â€œHelloâ€åˆçº¦çš„å…¬å…±å‡½æ•°è¿›è¡Œäº¤äº’ï¼Œé€šè¿‡äº¤æ˜“ï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆæƒå¸æˆ·æ·»åŠ åˆ°ç»„åˆä¸­ã€‚ è®©æˆ‘ä»¬ç¼–å†™æˆ‘ä»¬çš„ç¬¬ä¸€ç¬”äº¤æ˜“ã€‚


```cadence
import Hello from 0x01

transaction {

  let name: String

  prepare(account: AuthAccount) {
    self.name = account.address.toString()
  }

  execute {
    log(Hello.sayHi(to: self.name))
  }
}
```


ä¸ **Scripts** ä¸€æ ·ï¼Œæˆ‘ä»¬é¦–å…ˆå¯¼å…¥æˆ‘ä»¬å°†ä¸ä¹‹äº¤äº’çš„æ‰€æœ‰åˆçº¦ã€‚

ç„¶åæˆ‘ä»¬å£°æ˜ `transaction` ä¸»ä½“åŠå…¶å†…å®¹ã€‚ æ¯ä¸ªäº¤æ˜“æœ‰4ä¸ªé¡ºåºæ‰§è¡Œçš„æ­¥éª¤ï¼Œä½†å®ƒä»¬éƒ½æ˜¯å¯é€‰çš„ã€‚


```cadence
transaction(randomParameter: String) {
  let localVariable: Int
  prepare(signer: AuthAccount) {}
  pre {}
  execute {}
  post {}
}
```

å¦‚æœæˆ‘ä»¬æƒ³åœ¨ 4 ä¸ªé˜¶æ®µä¹‹é—´å…±äº«æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ `transaction` ä¸»ä½“ä¸­å£°æ˜å±€éƒ¨å˜é‡ï¼Œä¸éœ€è¦è®¿é—®ä¿®é¥°ç¬¦ã€‚

## å‡†å¤‡é˜¶æ®µï¼ˆPrepare phaseï¼‰

è¿™æ˜¯æ‚¨å¯ä»¥ç›´æ¥è®¿é—®ç”±â€œAuthAccountâ€å®ä¾‹æä¾›çš„å¸æˆ·å­˜å‚¨å’Œå…¶ä»–ç§æœ‰åŠŸèƒ½çš„å”¯ä¸€é˜¶æ®µã€‚ ç›®å‰ï¼Œæˆ‘ä»¬åªæ˜¯ä½¿ç”¨ `address` å­—æ®µï¼Œä½†æ‚¨å¯ä»¥åœ¨ [docs][3] ä¸­äº†è§£æ›´å¤šä¿¡æ¯ã€‚


## æ‰§è¡Œé˜¶æ®µï¼ˆExecute phaseï¼‰


åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ‚¨åº”è¯¥å­˜å‚¨äº¤æ˜“çš„ä¸»è¦çš„ä¸šåŠ¡é€»è¾‘ã€‚ æ‚¨ ** ä¸å¾—** è®¿é—®æ­¤å¤„ `AuthAccount` çš„ç§æœ‰å¯¹è±¡ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬åªéœ€è¦ `prepare` å’Œ `execute` é˜¶æ®µã€‚

åœ¨æˆ‘ä»¬çš„ `prepare` é˜¶æ®µï¼Œæˆ‘ä»¬è·å– `account.address` çš„å€¼å¹¶å­˜å‚¨ä¸‹æ¥ï¼Œä»¥ä¾›ä»¥ååœ¨ `execute` é˜¶æ®µè®¿é—®ã€‚

åœ¨ `execute` é˜¶æ®µï¼Œæˆ‘ä»¬è°ƒç”¨ `Hello` åˆçº¦çš„ `sayHi` å‡½æ•°ï¼Œä½¿ç”¨ç­¾åå¸æˆ·åœ°å€ä½œä¸º `name` å‚æ•°çš„å€¼ã€‚


## æ‰§è¡Œä¸€ä¸ªäº¤æ˜“



è®©æˆ‘ä»¬ä¸€èµ·å»æ‰§è¡Œè¿™ä¸ªäº¤æ˜“å§ï¼ åœ¨ **Transaction Signers** çª—æ ¼ä¸­ï¼Œé€‰æ‹©ä¸€ä¸ªå¸æˆ·ï¼Œå¯ä»¥æ˜¯ä»»ä½•å¸æˆ·ï¼Œç„¶åå•å‡» **Send**ã€‚

![äº¤æ˜“ç­¾åè€…](images/transaction.signers.jpg)

æ‚¨åº”è¯¥ä¼šçœ‹åˆ° **Log** çª—æ ¼æœ‰ä¸åŒå¸æˆ·åœ°å€çš„ä¿¡æ¯åœ¨æ›´æ–°ã€‚


```
11:11:11 Transaction > [1] > "Hi, 0x1"
11:11:11 Transaction > [2] > ()
11:11:12 Transaction > [3] > "Hi, 0x2"
11:11:12 Transaction > [4] > ()
```

# Contract #2

ç°åœ¨æˆ‘ä»¬å·²ç»ç†Ÿæ‚‰äº†  **ä»£ç æ¼”ç»ƒåœº (Flow Playground)** çš„åŠŸèƒ½ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹å°†æˆ‘ä»¬çš„åƒç´ è‰ºæœ¯çš„ç¨‹åºé€»è¾‘è½¬æ¢ä¸ºä¸€ä¸ªæ™ºèƒ½åˆçº¦ã€‚

```cadence
pub contract Artist {

  pub struct Canvas {

    pub let width: UInt8
    pub let height: UInt8
    pub let pixels: String

    init(width: UInt8, height: UInt8, pixels: String) {
      self.width = width
      self.height = height
      // The following pixels
      // 123
      // 456
      // 789
      // should be serialized as
      // 123456789
      self.pixels = pixels
    }
  }

  pub resource Picture {

    pub let canvas: Canvas

    init(canvas: Canvas) {
      self.canvas = canvas
    }
  }

  pub resource Printer {

    pub let width: UInt8
    pub let height: UInt8
    pub let prints: {String: Canvas}

    init(width: UInt8, height: UInt8) {
      self.width = width;
      self.height = height;
      self.prints = {}
    }

    pub fun print(canvas: Canvas): @Picture? {
      // Canvas needs to fit Printer's dimensions.
      if canvas.pixels.length != Int(self.width * self.height) {
        return nil
      }

      // Canvas can only use visible ASCII characters.
      for symbol in canvas.pixels.utf8 {
        if symbol < 32 || symbol > 126 {
          return nil
        }
      }

      // Printer is only allowed to print unique canvases.
      if self.prints.containsKey(canvas.pixels) == false {
        let picture <- create Picture(canvas: canvas)
        self.prints[canvas.pixels] = canvas

        return <- picture
      } else {
        return nil
      }
    }
  }

  init() {
    self.account.save(
      <- create Printer(width: 5, height: 5),
      to: /storage/ArtistPicturePrinter
    )
    self.account.link<&Printer>(
      /public/ArtistPicturePrinter,
      target: /storage/ArtistPicturePrinter
    )
  }
}
```

å¤§éƒ¨åˆ†ä»£ç ä½ åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå¹¶æ·»åŠ äº†ä¸€äº›æ–°å†…å®¹ã€‚

æ‰€æœ‰çš„ä»£ç éƒ½åŒ…å«åœ¨â€œcontract" çš„å…³é”®å­—ä¸­ï¼Œåœ¨Flowé‡Œå†™æ™ºèƒ½åˆçº¦æ—¶ï¼Œæ‚¨ä¸èƒ½åœ¨â€œcontractâ€å…³é”®å­—ä¹‹å¤–å£°æ˜ä»»ä½•å†…å®¹ã€‚

ç„¶åä½ å¯ä»¥çœ‹åˆ°æˆ‘å¯¹ `Printer` èµ„æºçš„å®ç°ï¼Œå®ƒå°†æ‰“å°ç‹¬ç‰¹çš„ `Canvas` ç»“æ„ã€‚ æˆ‘ä½¿ç”¨å­—å…¸çš„æ•°æ®ç»“æ„æ¥æ‰§è¡Œæ­¤æ“ä½œï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨æ•°ç»„ã€‚

æœ€åï¼Œè¿˜æœ‰ `init()` åˆå§‹åŒ–ç¨‹åºã€‚ è¿™æ˜¯æˆ‘ä»¬ä¸ºåˆçº¦è®¾ç½®ä¸€äº›åˆå§‹åŒ–æ“ä½œçš„åœ°æ–¹ã€‚ åœ¨åˆå§‹åŒ–ç¨‹åºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è®¿é—®â€œself.accountâ€ï¼Œå®ƒå±äºæˆ‘ä»¬ç†Ÿæ‚‰çš„â€œAuthAccountâ€ç±»å‹ï¼Œå¹¶ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹å¸æˆ·çš„å®Œå…¨ç§æœ‰çš„è®¿é—®æƒé™ã€‚


## å­˜å‚¨


åœ¨è¿™é‡Œæ‚¨å¯ä»¥çœ‹åˆ°æ­£åœ¨ä½¿ç”¨çš„ä¸¤ä¸ª **Account Storage API** æ–¹æ³•ï¼š`save` å’Œ `link`ã€‚ æœ‰äº†å®ƒä»¬ï¼Œæˆ‘ä»¬å°±èƒ½å¤ŸæŒä¹…åŒ–ä¸€ä¸ª `Printer` å®ä¾‹å¹¶æä¾›ç»™å…¶ä»–äººè®¿é—®å®ƒã€‚

```cadence
init() {
  self.account.save(
    <- create Printer(width: 5, height: 5),
    to: /storage/ArtistPicturePrinter
  )
  self.account.link<&Printer>(
    /public/ArtistPicturePrinter,
    target: /storage/ArtistPicturePrinter
  )
}
```

è®©æˆ‘ä»¬æ¢ç´¢æ¯ä¸€ä¸ªæ–¹æ³•çš„ç»†èŠ‚ä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚


### `save`

æˆ‘ä»¬æƒ³è¦åœ¨ Flow åŒºå—é“¾ä¸ŠæŒä¹…åŒ–çš„æ‰€æœ‰å†…å®¹ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»ç”¨ä¸€ä¸ªå¸æˆ·æ¥å­˜å‚¨ã€‚ `save` å‡½æ•°æ­£æ˜¯è¿™æ ·åšçš„ï¼Œæˆ‘ä»¬ç»™å‡ºäº†ä¸€ä¸ªå€¼å’Œä¸€ä¸ªå”¯ä¸€çš„å­˜å‚¨ä½ç½®ã€‚


```cadence
fun save<T>(_ value: T, to: StoragePath)
```

æ‚¨å¯ä»¥åœ¨ä¸¤éƒ¨åˆ†ä¸­å®šä¹‰å­˜å‚¨å€¼çš„è·¯å¾„ï¼š`/domain/uniqueIdentifier`ã€‚ å­˜åœ¨ä¸‰ä¸ªå¯èƒ½çš„åŸŸã€‚

1. `storage`ï¼šå€¼çš„å®é™…ä½ç½®ï¼Œåªä½¿ç”¨ `save()` å’Œ `storage`ã€‚
2. `public`ï¼šå¯ä»¥é€šè¿‡`PublicAccount`ï¼Œåœ¨æœªç»æˆæƒçš„æƒ…å†µä¸‹è®¿é—®ã€‚
3. `private`ï¼šå¿…é¡»é€šè¿‡`AuthAccount`æˆæƒè®¿é—®ã€‚

ä½œä¸ºå‚è€ƒï¼Œè¯·ä½¿ç”¨ [docs][5]ã€‚


### `link`


å¦‚æœæˆ‘ä»¬åªæ˜¯ç”¨åˆçº¦è´¦æˆ·å­˜å‚¨ä¸€ä¸ª `Printer` çš„å®ä¾‹ï¼Œé‚£ä¹ˆæ¯ä¸ªæƒ³è¦å°† `Canvas` æ‰“å°ä¸º `Picture` çš„äººéƒ½éœ€è¦æ¥è‡ªåˆçº¦è´¦æˆ·çš„æˆæƒå’Œç­¾åã€‚ è¿™å¾ˆéº»çƒ¦ï¼Œæˆ‘ä»¬å¸Œæœ›è®©æ¯ä¸ªäººéƒ½å¯ä»¥è‡ªç”±æ‰“å°â€œå›¾ç‰‡â€ã€‚

Cadence é‡‡ç”¨**åŸºäºèƒ½åŠ›çš„è®¿é—®æ§åˆ¶**ï¼Œå…è®¸æ™ºèƒ½åˆçº¦å°†å…¶éƒ¨åˆ†å­˜å‚¨å…¬å¼€ç»™å…¶ä»–è´¦æˆ·ã€‚

é€šè¿‡è°ƒç”¨`link`ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`Capability`ã€‚

```cadence
fun link<T: &Any>(_ newCapabilityPath: CapabilityPath, target: Path): Capability<T>?
```

ä½ ä¸€å®šä¼šé—®è‡ªå·±è¿™ä¸ª`&`ç¬¦å·çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿ



### å¼•ç”¨


æˆ‘ä»¬å¯ä»¥åˆ›å»ºå¯¹èµ„æºå’Œç»“æ„çš„å¼•ç”¨ã€‚ å¼•ç”¨ä½¿æˆ‘ä»¬èƒ½å¤Ÿè®¿é—®æ‰€å¼•ç”¨å¯¹è±¡çš„å­—æ®µå’Œå‡½æ•°ã€‚

æ‚¨å¯ä»¥åˆ›å»ºå¼•ç”¨ã€‚å¦‚ä¸‹é¢çš„ä»£ç ä¾‹å­ã€‚

```cadence
let name = "Morgan"
let nameRef: &String = &name as &String
```

Or you can borrow them from capabilities.

æˆ–è€…æ‚¨å¯ä»¥ä»åŠŸèƒ½ä¸­å€Ÿç”¨å®ƒä»¬ã€‚

```cadence
let printerRef = getAccount(0x01)
  .getCapability<&Artist.Printer>(/public/ArtistPicturePrinter)
  .borrow()
  ?? panic("Couldn't borrow reference to Printer")

// ç›®å‰ printerRef å¯ä»¥è®¿é—®åº•å±‚æ‰“å°æœºèµ„æºçš„æ¯ä¸ªå­—æ®µå’ŒåŠŸèƒ½ã€‚
printerRef.print(...)
```

ä½œä¸ºå‚è€ƒ ğŸ™‚ï¼Œè¯·ä½¿ç”¨ [docs][6]ã€‚



# äº¤æ˜“ #2


å¥½å§ï¼ å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªæ–°çš„æ™ºèƒ½åˆçº¦ï¼Œè®©æˆ‘ä»¬æµ‹è¯•ä¸€ä¸‹ã€‚


```cadence
import Artist from 0x02

transaction() {

  let pixels: String
  let picture: @Artist.Picture?

  prepare(account: AuthAccount) {
    let printerRef = getAccount(0x02)
      .getCapability<&Artist.Printer>(/public/ArtistPicturePrinter)
      .borrow()
      ?? panic("Couldn't borrow printer reference.")

    // Replace with your own drawings.
    self.pixels = "*   * * *   *   * * *   *"
    let canvas = Artist.Canvas(
      width: printerRef.width,
      height: printerRef.height,
      pixels: self.pixels
    )

    self.picture <- printerRef.print(canvas: canvas)
  }

  execute {
    if (self.picture == nil) {
      log("Picture with ".concat(self.pixels).concat(" already exists!"))
    } else {
      log("Picture printed!")
    }

    destroy self.picture
  }
}
```


æ­¤äº¤æ˜“æ—¨åœ¨æ‰“å°ç‹¬ç‰¹çš„å›¾ç‰‡å¹¶åœ¨ä¹‹åé”€æ¯å®ƒä»¬ã€‚ è‰ºæœ¯çš„æè‡´ä½“ç°ï¼ é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œ`getAccount` å‡½æ•°ä½¿ç”¨å¸æˆ·åœ°å€æ¥è·å–`PublicAccount` çš„ä¸€ä¸ªå®ä¾‹ã€‚

å¦‚æœæˆ‘ä»¬è¿è¡Œè¿™ä¸ªäº¤æ˜“ä¸¤æ¬¡ï¼Œæˆ‘ä»¬åº”è¯¥å¾—åˆ°ä»¥ä¸‹æ—¥å¿—ã€‚


```
11:11:11 New Transaction > [1] > "Picture printed!"
11:11:12 New Transaction > [2] > "Picture with *   * * *   *   * * *   * already exists!"
```


æœ€åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨æ‰˜ç®¡æˆ‘ä»¬çš„â€œè‰ºæœ¯å®¶â€åˆçº¦çš„å¸æˆ·çš„ **Storage** çª—æ ¼ä¸­çœ‹åˆ°æ›´æ”¹ã€‚

![å­˜å‚¨é¢æ¿](images/storage.jpg)

# è¯¾åä½œä¸š


é€šè¿‡ç¬¬äºŒå¤©çš„å­¦ä¹ ï¼Œæˆ‘ä»¬å·²ç»èƒ½å¤Ÿåœ¨æ¨¡æ‹Ÿçš„ Flow åŒºå—é“¾ä¸Šç¼–å†™æ™ºèƒ½åˆçº¦å¹¶æ‰§è¡Œäº¤æ˜“ã€‚

è®©æˆ‘ä»¬æ·±å…¥å­¦ä¹ ï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦å¯ä»¥å®Œæˆä»¥ä¸‹çš„è¯¾åä½œä¸šçš„ä»»åŠ¡ï¼


- `W1Q3` â€“ æˆ‘çš„çå®!


ä¸ºæˆ‘ä»¬çš„â€œè‰ºæœ¯å®¶â€åˆçº¦åˆ›å»ºä¸€ä¸ªâ€œCollection æ”¶è—â€èµ„æºï¼Œè¿™å°†å…è®¸å¸æˆ·åœ¨æ‰“å°åå­˜å‚¨ä»–ä»¬çš„â€œå›¾ç‰‡â€èµ„æºã€‚ è¯·æ³¨æ„ï¼Œæ‚¨åªèƒ½åœ¨åˆçº¦ä¸­åˆ›å»ºèµ„æºã€‚


```cadence
pub resource Collection {
  pub fun deposit(picture: @Picture)
}
pub fun createCollection(): Collection
```

æµ‹è¯•ä½ çš„ `Collection  æ”¶è—`ã€‚


- `W1Q4` â€“ è¡Œå®¶

ç¼–å†™ä¸€ä¸ªè„šæœ¬ï¼Œæ‰“å°æ‰€æœ‰äº”ä¸ª Playground å¸æˆ·ï¼ˆ`0x01`ã€`0x02` ç­‰ï¼‰çš„æ”¶è—çš„å†…å®¹ã€‚ è¯·ä½¿ç”¨æ‚¨çš„å¸¦æ¡†ç”»å¸ƒæ‰“å°æœºåŠŸèƒ½ï¼Œä»¥æ¸…æ™°æ˜“è¯»çš„æ–¹å¼åœ¨æ—¥å¿—ä¸­è®°å½•æ¯ä¸ªâ€œå›¾ç‰‡â€çš„ç”»å¸ƒã€‚ ä¸ºæ²¡æœ‰`Collectionæ”¶è—` çš„å¸æˆ·æä¾›æ—¥å¿—ã€‚

è¯·ä½¿ç”¨æ­¤æ–‡ä»¶å¤¹ä¸­æä¾›çš„â€œ.cdcâ€å­˜æ ¹ï¼Œæ¥æäº¤æ‚¨å¯¹è¿™äº›ä»»åŠ¡çš„è§£å†³æ–¹æ¡ˆã€‚

```
- artist.contract.cdc
- getCollections.script.cdc
```

ç¥ä½ å®Œæˆè¯¾åä½œä¸šæ—¶å¥½è¿ï¼

[1]: https://play.onflow.org/
[2]: https://docs.onflow.org/cadence/language/transactions/
[3]: https://docs.onflow.org/cadence/language/accounts/
[4]: https://docs.onflow.org/cadence/language/accounts/#account-storage
[5]: https://docs.onflow.org/cadence/language/capability-based-access-control/
[6]: https://docs.onflow.org/cadence/language/references/